# Requirements Document

## Introduction

KufarEnjoyer_bot - это Telegram бот-парсер для отслеживания новых объявлений на белорусских площадках (Kufar.by, Onliner.by, Realt.by). Бот предоставляет простой способ получать уведомления о новых объявлениях по заданным пользователем ссылкам с фильтрами.

## Glossary

- **Bot** - Telegram бот KufarEnjoyer_bot
- **User** - пользователь Telegram, взаимодействующий с ботом
- **Link** - URL-адрес страницы с фильтрами для отслеживания
- **Ad** - объявление на площадке
- **Parser** - компонент системы, который извлекает данные с площадок
- **Database** - PostgreSQL база данных для хранения пользователей и объявлений
- **Platform** - площадка объявлений (Kufar, Onliner, Realt)

## Requirements

### Requirement 1: Регистрация пользователя

**User Story:** Как пользователь, я хочу начать использовать бота, чтобы отслеживать объявления

#### Acceptance Criteria

1. WHEN User отправляет команду /start, THE Bot SHALL автоматически зарегистрировать пользователя
2. THE Bot SHALL сохранить данные пользователя (telegram_id, username) в Database
3. THE Bot SHALL отобразить главное меню с кнопками: "Добавить ссылку", "Мои ссылки"

### Requirement 2: Добавление ссылки для отслеживания

**User Story:** Как пользователь, я хочу добавить ссылку для отслеживания, чтобы получать уведомления о новых объявлениях

#### Acceptance Criteria

1. WHEN User выбирает "Отслеживать" в меню, THE Bot SHALL отобразить список добавленных ссылок или кнопку "Добавить ссылку"
2. WHEN User нажимает "Добавить ссылку", THE Bot SHALL запросить URL-адрес страницы
3. WHEN User отправляет URL, THE Bot SHALL определить Platform (Kufar, Onliner, Realt) по домену
4. THE Bot SHALL проверить корректность ссылки для определенной Platform
5. IF ссылка корректна, THEN THE Bot SHALL сохранить ссылку в Database и начать отслеживание
6. IF ссылка некорректна, THEN THE Bot SHALL отобразить сообщение об ошибке
7. THE Bot SHALL поддерживать до 10 активных ссылок на одного пользователя

### Requirement 3: Парсинг объявлений

**User Story:** Как система, я хочу регулярно проверять новые объявления, чтобы уведомлять пользователей

#### Acceptance Criteria

1. THE Parser SHALL выполнять проверку новых объявлений каждую минуту для всех активных ссылок
2. WHEN Parser обнаруживает новое объявление, THE Parser SHALL сохранить его в Database
3. THE Parser SHALL извлекать следующие данные: заголовок, описание, цену, фото, ссылку на объявление
4. THE Parser SHALL обрабатывать разные типы объявлений (недвижимость, авто, другое)
5. IF парсинг ссылки завершается ошибкой более 5 раз подряд, THEN THE Bot SHALL пометить ссылку как неактивную

### Requirement 4: Уведомления о новых объявлениях

**User Story:** Как пользователь, я хочу получать уведомления о новых объявлениях, чтобы быть в курсе актуальных предложений

#### Acceptance Criteria

1. WHEN Parser обнаруживает новое объявление, THE Bot SHALL отправить уведомление User
2. THE Bot SHALL отправлять уведомление с фото, заголовком, ценой и ссылкой на объявление
3. IF у объявления нет фото, THEN THE Bot SHALL отправить текстовое сообщение
4. THE Bot SHALL группировать уведомления (не более 1 сообщения в минуту на ссылку)
5. THE Bot SHALL отправлять уведомления только о новых объявлениях (не дубликаты)

### Requirement 5: Управление ссылками

**User Story:** Как пользователь, я хочу управлять своими ссылками, чтобы контролировать что отслеживается

#### Acceptance Criteria

1. WHEN User выбирает ссылку из списка, THE Bot SHALL отобразить информацию о ссылке (URL, Platform)
2. THE Bot SHALL предоставить кнопку "Удалить"
3. WHEN User удаляет ссылку, THE Bot SHALL удалить ссылку из Database

### Requirement 6: Надежность и производительность

**User Story:** Как система, я хочу работать стабильно и быстро, чтобы пользователи получали актуальные данные

#### Acceptance Criteria

1. THE Bot SHALL обрабатывать до 1000 пользователей одновременно
2. THE Parser SHALL обрабатывать до 3000 ссылок одновременно
3. THE Bot SHALL отвечать на команды пользователя в течение 2 секунд
4. THE Bot SHALL автоматически переподключаться к Database при потере соединения
5. THE Bot SHALL логировать все ошибки для отладки

### Requirement 7: Развертывание

**User Story:** Как разработчик, я хочу легко развернуть бота, чтобы быстро запустить его в production

#### Acceptance Criteria

1. THE Bot SHALL запускаться через Docker Compose одной командой
2. THE Bot SHALL использовать переменные окружения для конфигурации (только TELEGRAM_BOT_TOKEN и DATABASE_URL)
3. THE Bot SHALL автоматически создавать необходимые таблицы в Database при первом запуске
4. THE Bot SHALL использовать только PostgreSQL (без Redis и других зависимостей)
